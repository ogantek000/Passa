<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Keepy ‚Äì Keep Going</title>
<link rel="icon" href="icon.png">

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,'Helvetica Neue',sans-serif;
  background:#0f172a;color:white;margin:0;padding:16px;
}
.header{text-align:center;margin-bottom:10px}
.mascot{width:200px;height:200px;border-radius:50%;object-fit:cover}
h1{margin:6px 0 2px;color:#3b82f6}
.motto{color:#94a3b8;font-size:14px}
#countdown{font-size:16px;font-weight:600;color:#94a3b8;margin:6px 0 14px}

#stats{
  display:flex;justify-content:space-around;
  background:rgba(255,255,255,0.05);
  padding:12px;border-radius:14px;margin-bottom:14px;
}
#stats div{text-align:center}
#stats div div:first-child{font-size:13px;color:#94a3b8}
#stats div div:last-child{font-size:18px;font-weight:bold}

.habit{
  background:rgba(255,255,255,0.05);
  padding:16px;border-radius:14px;margin-bottom:12px;
  opacity:0;transform:translateY(20px);
  transition:.25s;position:relative
}
.habit.show{opacity:1;transform:none}

.habit.ice::after{
  content:"";position:absolute;inset:0;
  background:#3b82f6;opacity:0;border-radius:14px;
  animation:ice .8s
}
@keyframes ice{30%,60%{opacity:.6}100%{opacity:0}}

.habit-header{
  display:flex;justify-content:space-between;align-items:center
}
.name{font-size:18px}
.streak{font-size:20px;color:#ff9500}

.actions{display:flex;gap:6px}
.actions button{
  padding:6px 10px;border:none;border-radius:8px;cursor:pointer
}
.done{background:#22c55e}
.freeze{background:#facc15}
.more{background:#1e293b;color:white;font-size:18px}

.menu{
  position:absolute;right:12px;top:52px;
  background:#020617;border-radius:10px;
  overflow:hidden;display:none;
  box-shadow:0 10px 30px rgba(0,0,0,.5);z-index:2
}
.menu button{
  width:100%;padding:10px 14px;
  background:none;border:none;color:white;
  text-align:left;cursor:pointer
}
.menu button:hover{background:rgba(255,255,255,.08)}

.toggle-cal{
  width:100%;margin-top:8px;
  padding:8px;border:none;border-radius:8px;
  background:#3b82f6;color:white;cursor:pointer
}

.calendar-container{margin-top:8px}
.calendar{
  display:flex;flex-wrap:wrap;
  max-height:0;opacity:0;overflow:hidden;
  transition:.35s;pointer-events:none;position:relative
}
.calendar.show{max-height:400px;opacity:1;pointer-events:auto}

.calendar-header{
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:4px;
}
.calendar-header button,
.calendar-header span{
  visibility:hidden;
}
.calendar.show .calendar-header button,
.calendar.show .calendar-header span{
  visibility:visible;
}

.calendar.editing{
  outline:2px dashed #f97316
}

.day{
  width:14.2%;height:28px;
  line-height:28px;text-align:center;
  font-size:12px;border-radius:6px;
  background:#111827
}
.calendar.editing .day{cursor:pointer}

.day.done{background:#22c55e;color:black}
.day.freeze{background:#facc15;color:black}
.day.missed{background:#ef4444;color:white}
.day.locked{opacity:.35}

.add{
  position:fixed;bottom:24px;right:24px;
  width:56px;height:56px;border-radius:50%;
  background:#22c55e;font-size:32px;border:none;cursor:pointer
}
</style>
</head>
<body>

<div class="header">
  <img src="bro.jpg" class="mascot">
  <h1>Keepy</h1>
  <p class="motto">Keep Going</p>
  <div id="countdown">--:--:--</div>
</div>

<div id="stats">
  <div><div>Dni wykonane</div><div id="totalDone">0</div></div>
  <div><div>Najd≈Çu≈ºsza passa</div><div id="maxStreak">0</div></div>
  <div><div>≈örednia dzienna</div><div id="avgDaily">0</div></div>
</div>

<div id="list"></div>
<button class="add" id="addBtn">+</button>

<script>
const DAY=86400000;
const list=document.getElementById("list");

function today(){
  const d=new Date();
  d.setMinutes(d.getMinutes()-d.getTimezoneOffset());
  return d.toISOString().slice(0,10);
}

/* ‚è±Ô∏è ZEGAR DO P√ì≈ÅNOCY */
function startCountdown(){
  const el=document.getElementById("countdown");
  setInterval(()=>{
    const now=new Date();
    const midnight=new Date();
    midnight.setHours(24,0,0,0);
    const diff=midnight-now;
    const h=String(Math.floor(diff/3600000)).padStart(2,"0");
    const m=String(Math.floor(diff%3600000/60000)).padStart(2,"0");
    const s=String(Math.floor(diff%60000/1000)).padStart(2,"0");
    el.textContent=`${h}:${m}:${s}`;
  },1000);
}
startCountdown();

let habits=JSON.parse(localStorage.getItem("keepy"))||[];
const save=()=>localStorage.setItem("keepy",JSON.stringify(habits));

function updateStats(){
  let total=0,max=0,dates={};
  habits.forEach(h=>{
    h.datesDone.forEach(d=>{
      total++;dates[d]=(dates[d]||0)+1;
    });
    if(h.streak>max)max=h.streak;
  });
  const days=Object.keys(dates).length||1;
  totalDone.textContent=total;
  maxStreak.textContent=max;
  avgDaily.textContent=(total/days).toFixed(2);
}

function renderCalendar(h){
  const cont=document.createElement("div");
  cont.className="calendar-container";

  const cal=document.createElement("div");
  cal.className="calendar";
  if(h.calendarOpen) cal.classList.add("show");
  if(h.editing) cal.classList.add("editing");

  const header=document.createElement("div");
  header.className="calendar-header";

  const l=document.createElement("button");
  const r=document.createElement("button");
  l.textContent="<"; r.textContent=">";

  const ref=new Date();
  ref.setMonth(ref.getMonth()+h.monthOffset);

  const title=document.createElement("span");
  title.textContent=ref.toLocaleString("pl-PL",{month:"long",year:"numeric"});

  header.append(l,title,r);
  cal.append(header);

  const first=(new Date(ref.getFullYear(),ref.getMonth(),1).getDay()+6)%7;
  const daysInMonth=new Date(ref.getFullYear(),ref.getMonth()+1,0).getDate();

  for(let i=0;i<first;i++) cal.append(document.createElement("div"));

  for(let d=1;d<=daysInMonth;d++){
    const date=new Date(ref.getFullYear(),ref.getMonth(),d);
    const ds=new Date(date.getTime()-date.getTimezoneOffset()*60000).toISOString().slice(0,10);
    const diff=(new Date(today())-new Date(ds))/DAY;
    const editable=diff>=0 && diff<=7;

    const div=document.createElement("div");
    div.className="day";
    div.textContent=d;

    if(h.datesDone.includes(ds)) div.classList.add("done");
    else if(h.freezeDates.includes(ds)) div.classList.add("freeze");
    else if(diff>0) div.classList.add("missed");

    if(!editable) div.classList.add("locked");

    div.onclick=()=>{
      if(!h.editing || !editable) return;
      if(h.datesDone.includes(ds))
        h.datesDone=h.datesDone.filter(x=>x!==ds);
      else
        h.datesDone.push(ds);
      save();render();
    };

    cal.append(div);
  }

  l.onclick=(e)=>{
    e.stopPropagation();
    h.monthOffset--; save(); render();
  };
  r.onclick=(e)=>{
    e.stopPropagation();
    h.monthOffset++; save(); render();
  };

  cont.append(cal);
  return {cont,cal};
}

function render(){
  list.innerHTML="";
  habits.forEach((h,i)=>{
    const div=document.createElement("div");
    div.className="habit";

    div.innerHTML=`
      <div class="habit-header">
        <div>
          <div class="name">${h.name}</div>
          <div class="streak">üî• ${h.streak}</div>
        </div>
        <div class="actions">
          <button class="done">Zrobione dzi≈õ</button>
          <button class="freeze">${h.freeze?"Odmr√≥≈∫":"Freeze"}</button>
          <button class="more">‚ãØ</button>
        </div>
      </div>
      <div class="menu">
        <button class="editHist">‚úèÔ∏è Edytuj historiƒô</button>
        <button class="deleteHist">üóë Usu≈Ñ passƒô</button>
      </div>
    `;

    const menu=div.querySelector(".menu");
    div.querySelector(".more").onclick=()=>{menu.style.display=menu.style.display==="block"?"none":"block";};

    const toggle=document.createElement("button");
    toggle.className="toggle-cal";
    toggle.textContent=h.calendarOpen?"üìÖ Ukryj kalendarz":"üìÖ Poka≈º kalendarz";

    const {cont,cal}=renderCalendar(h);

    toggle.onclick=()=>{
      h.calendarOpen=!h.calendarOpen;
      save();render();
    };

    div.querySelector(".editHist").onclick=()=>{
      h.editing=!h.editing;
      menu.style.display="none";
      save();render();
    };

    div.querySelector(".deleteHist").onclick=()=>{
      if(confirm("UsunƒÖƒá passƒô?")){
        habits.splice(i,1); save(); render();
      }
    };

    div.querySelector(".done").onclick=()=>{
      if(h.freeze) return;
      if(!h.datesDone.includes(today())){
        h.datesDone.push(today());
        h.streak++;
        save(); render();
      }
    };

    div.querySelector(".freeze").onclick=()=>{
      h.freeze=!h.freeze;
      div.classList.add("ice");
      setTimeout(()=>div.classList.remove("ice"),800);
      save(); render();
    };

    div.append(toggle,cont);
    list.append(div);
    setTimeout(()=>div.classList.add("show"),10);
  });
  updateStats();
}

document.getElementById("addBtn").onclick=()=>{
  const n=prompt("Nazwa passy:");
  if(n){
    habits.push({
      name:n,
      streak:0,
      datesDone:[],
      freezeDates:[],
      freeze:false,
      monthOffset:0,
      calendarOpen:false,
      editing:false
    });
    save();render();
  }
};

render();
</script>
</body>
</html>
